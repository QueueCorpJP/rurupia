# るぴぴあ (Rupipia) Project Understanding Summary

## Project Overview
Rupipia is a therapist booking platform built with React/TypeScript, using Supabase as the backend and deployed on AWS S3/CloudFront. The platform allows customers to search for and book appointments with therapists, while providing management dashboards for therapists, stores, and administrators.

## Tech Stack
- **Frontend**: React 18 + TypeScript + Vite
- **UI**: Tailwind CSS + shadcn/ui components
- **Backend**: Supabase (PostgreSQL + Auth + Edge Functions)
- **Deployment**: AWS S3 + CloudFront
- **Authentication**: LINE Login integration + Supabase Auth

## Key Features

### Multi-User System
- **Customers**: Browse/search therapists, book appointments, write reviews
- **Therapists**: Manage profile, availability, bookings
- **Stores**: Manage multiple therapists, store information
- **Admin**: Full system administration

### Authentication & Authorization
- LINE Login integration via Supabase Edge Functions
- Traditional email/password authentication
- Protected routes based on user types
- Session management with localStorage user type tracking

### Data Architecture
- **therapists**: Therapist profiles with specialties, pricing, availability
- **stores**: Store information and management
- **bookings**: Appointment scheduling
- **reviews**: Customer reviews and ratings
- **profiles**: User profile information

## Recent Major Fixes (Latest Updates)

### December 2024 - Data Display & UI Fixes
**Issue**: No Supabase data being displayed, mobile logo too large, missing rating component circle icon

**Root Cause**: 
- Therapist data had null/empty values preventing proper filtering
- Mobile responsive design needed refinement
- Rating slider needed visual enhancement

**Solutions Applied**:

1. **Supabase Data Fixes**:
   - Updated therapist record with proper price (5000 yen)
   - Added availability: ["平日", "週末"] (weekdays, weekends)
   - Added specialties: ["マッサージ", "アロマセラピー"] (massage, aromatherapy)
   - Added questionnaire_data with mood, therapistType, treatmentType
   - Fixed rating to 4.5 (numeric value)

2. **Mobile Logo Optimization**:
   - Header logo: `h-8 w-auto sm:h-12 md:h-14` (32px on mobile, scales up)
   - Footer logo: `h-6 w-auto sm:h-8 md:h-10` (24px on mobile, scales up)

3. **Rating Component Enhancement**:
   - Added circular icon at end of rating slider in TherapistFilters.tsx
   - Positioned with absolute positioning for visual appeal

### November 2024 - PM Feedback Implementation
**Issues Addressed**:
1. ✅ Fixed 404 errors for password reset pages (`/therapist/reset-password`, `/store/reset-password`)
2. ✅ Fixed range slider to properly display both circular handles
3. ✅ Added Japanese meta tags for social media sharing
4. ✅ Fixed therapist search infinite loading states
5. ✅ Documented admin credentials (admin@rupipia.jp / admin123!)
6. ✅ Added footer logo with responsive sizing
7. ✅ Updated project documentation

### October 2024 - LINE Authentication Fix
**Issue**: Users successfully authenticated with LINE but were redirected back to login
**Root Cause**: LineCallback component created localStorage entries instead of Supabase sessions
**Solution**: Updated Edge Function and LineCallback to use proper `signInWithPassword` flow

## Deployment Information
- **S3 Bucket**: `therapist-connectivity-frontend-93b9faa0`
- **CloudFront Distribution**: `E2P3Q41GY0N3CJ`
- **Latest Deployment**: December 2024 (fixed data display issues)

## Admin Access
- **URL**: Navigate to `/admin-auth`
- **Credentials**: 
  - Email: admin@rupipia.jp
  - Password: admin123!

## Current Database Status
- **Project ID**: vvwkuqnotnilsbcswfqu
- **Status**: ACTIVE_HEALTHY
- **Sample Data**: 1 therapist with proper data, 7 user profiles
- **Tables**: therapists, stores, profiles, bookings, reviews, availability, services

## Key Files Modified
- `src/components/Layout.tsx` - Navigation, authentication, responsive logos
- `src/components/TherapistFilters.tsx` - Enhanced rating component
- `src/pages/Therapists.tsx` - Search and filtering logic
- `src/App.tsx` - Route definitions
- `supabase/functions/line-auth-handler/index.ts` - LINE authentication
- `index.html` - Japanese meta tags

## Next Steps / Known Areas for Improvement
- Consider adding more sample therapist data for testing
- Monitor user feedback on mobile logo sizing
- Potentially add more visual enhancements to filter components
- Consider performance optimization for large datasets